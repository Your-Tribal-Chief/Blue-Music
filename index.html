<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue Music Player</title>
    <style>
        :root {
            /* Light theme colors */
            --bg-primary: #000;
            --bg-secondary: rgba(255, 255, 255, 0.1);
            --text-primary: #fff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --accent-1: #8a2be2;
            --accent-2: #1e90ff;
            --accent-3: #ffe91e;
            --gradient-bg: linear-gradient(125deg, #000428 0%, #004e92 100%);
            --particle-color: rgba(255, 255, 255, 0.5);
            --border-color: rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] {
            /* Dark theme colors */
            --bg-primary: #0a0a0a;
            --bg-secondary: rgba(20, 20, 30, 0.8);
            --text-primary: #e0e0e0;
            --text-secondary: rgba(200, 200, 200, 0.7);
            --accent-1: #bb86fc;
            --accent-2: #03dac6;
            --accent-3: #ff6b35;
            --gradient-bg: linear-gradient(125deg, #1a1a2e 0%, #16213e 100%);
            --particle-color: rgba(187, 134, 252, 0.6);
            --border-color: rgba(187, 134, 252, 0.3);
        }

        [data-theme="neon"] {
            /* Neon theme colors */
            --bg-primary: #000;
            --bg-secondary: rgba(0, 255, 255, 0.1);
            --text-primary: #00ffff;
            --text-secondary: rgba(0, 255, 255, 0.8);
            --accent-1: #ff0080;
            --accent-2: #00ff41;
            --accent-3: #ffff00;
            --gradient-bg: linear-gradient(125deg, #0d0d23 0%, #1a0033 100%);
            --particle-color: rgba(255, 0, 128, 0.8);
            --border-color: rgba(0, 255, 255, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        /* Enhanced animated background with rainbow hover effect */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: var(--gradient-bg);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .background:hover {
            background: linear-gradient(45deg, 
                #ff0000, #ff8000, #ffff00, #80ff00, 
                #00ff00, #00ff80, #00ffff, #0080ff, 
                #0000ff, #8000ff, #ff00ff, #ff0080
            );
            background-size: 400% 400%;
            animation: rainbowFlow 3s ease infinite;
        }

        @keyframes rainbowFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .background::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--accent-1) 0%, transparent 70%);
            opacity: 0.3;
            animation: pulse 15s ease-in-out infinite;
        }

        .background::after {
            content: '';
            position: absolute;
            bottom: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--accent-2) 0%, transparent 70%);
            opacity: 0.3;
            animation: pulse 20s ease-in-out infinite reverse;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }

        /* Enhanced Floating particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--particle-color);
            border-radius: 50%;
            animation: float 20s infinite ease-in-out;
            box-shadow: 0 0 10px var(--particle-color);
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(100vh) translateX(0) scale(0); 
                opacity: 0; 
            }
            10% { 
                opacity: 1; 
                transform: translateY(90vh) translateX(20px) scale(1);
            }
            90% { 
                opacity: 1; 
                transform: translateY(10vh) translateX(80px) scale(1);
            }
            100% { 
                transform: translateY(-10vh) translateX(100px) scale(0); 
                opacity: 0; 
            }
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 50px;
            padding: 10px;
            display: flex;
            gap: 5px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .theme-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 8px 12px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .theme-btn.active {
            background: linear-gradient(45deg, var(--accent-1), var(--accent-2));
            color: white;
            transform: scale(1.05);
        }

        .theme-btn:hover:not(.active) {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Mobile responsive container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .theme-toggle {
                top: 10px;
                right: 10px;
                padding: 8px;
            }
            
            .theme-btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .logo {
                font-size: 2rem !important;
            }
            
            .search-box {
                padding: 0.8rem !important;
            }
            
            .search-input {
                padding: 0.8rem 2.5rem 0.8rem 1rem !important;
                font-size: 1rem !important;
            }
            
            .search-btn {
                padding: 0.6rem 1rem !important;
                font-size: 0.9rem !important;
            }
            
            .results-container {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
                gap: 1rem !important;
            }
        }

        /* Enhanced header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 1s ease-out;
        }

        .logo {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(45deg, var(--accent-1), var(--accent-3), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px var(--accent-1)); }
            50% { filter: drop-shadow(0 0 40px var(--accent-2)); }
        }

        /* Enhanced search section */
        .search-container {
            max-width: 600px;
            margin: 0 auto 3rem;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .search-box {
            position: relative;
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .search-box:hover {
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
            border-color: var(--accent-1);
        }

        .search-input {
            width: 100%;
            padding: 1rem 3rem 1rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.1rem;
            outline: none;
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-btn {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(45deg, var(--accent-1), var(--accent-2));
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 5px 20px var(--accent-1);
        }

        /* Enhanced results section */
        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
            animation: fadeIn 0.5s ease-out;
        }

        .result-card {
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
            animation: slideUp 0.5s ease-out;
            position: relative;
        }

        .result-card:hover {
            transform: translateY(-10px) scale(1.02);
            background: var(--bg-secondary);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border-color: var(--accent-1);
        }

        .result-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .result-card:hover .result-thumbnail {
            transform: scale(1.1);
        }

        .result-info {
            padding: 1.5rem;
        }

        .result-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            color: var(--text-primary);
        }

        .result-channel {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        /* Queue button */
        .queue-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, var(--accent-2), var(--accent-3));
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            transform: scale(0.8);
        }

        .result-card:hover .queue-btn {
            opacity: 1;
            transform: scale(1);
        }

        .queue-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px var(--accent-2);
        }

        /* Card Mode Player */
        .card-player {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 90vw;
            max-width: 800px;
            height: 90vh;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            overflow: hidden;
            z-index: 2000;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .card-player.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .card-player-header {
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .card-player-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-player-close {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .card-player-close:hover {
            background: var(--accent-1);
            transform: scale(1.1);
        }

        .card-player-content {
            display: flex;
            height: calc(100% - 80px);
        }

        .card-player-left {
            flex: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .card-player-thumbnail {
            width: 300px;
            height: 300px;
            border-radius: 20px;
            object-fit: cover;
            margin-bottom: 2rem;
            animation: rotate 20s linear infinite paused;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .card-player.playing .card-player-thumbnail {
            animation-play-state: running;
        }

        .card-player-info {
            text-align: center;
            margin-bottom: 2rem;
        }

        .card-player-song-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .card-player-artist {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .card-player-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .card-control-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-control-btn:hover {
            background: var(--bg-secondary);
            transform: scale(1.1);
            border-color: var(--accent-1);
        }

        .card-play-pause-btn {
            width: 70px;
            height: 70px;
            background: linear-gradient(45deg, var(--accent-1), var(--accent-2));
            border: none;
            font-size: 2rem;
        }

        .card-play-pause-btn:hover {
            box-shadow: 0 0 30px var(--accent-1);
        }

        /* Lyrics section */
        .card-player-right {
            flex: 1;
            padding: 2rem;
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
        }

        .lyrics-header {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
            text-align: center;
        }

        .lyrics-content {
            line-height: 1.8;
            color: var(--text-secondary);
            font-size: 1rem;
            white-space: pre-line;
            animation: fadeIn 1s ease-out;
        }

        .lyrics-loading {
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Queue Panel */
        .queue-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-left: 1px solid var(--border-color);
            z-index: 1500;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .queue-panel.active {
            right: 0;
        }

        .queue-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .queue-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .queue-close {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .queue-list {
            padding: 1rem;
        }

        .queue-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: var(--bg-secondary);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .queue-item:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-1);
        }

        .queue-item.current {
            border-color: var(--accent-1);
            background: linear-gradient(45deg, var(--accent-1), var(--accent-2));
            color: white;
        }

        .queue-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
            margin-right: 1rem;
        }

        .queue-info {
            flex: 1;
        }

        .queue-song-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .queue-artist {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .queue-remove {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s ease;
        }

        .queue-remove:hover {
            color: var(--accent-1);
        }

        /* Minimized player */
        .player-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border-color);
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
        }

        .player-container.active {
            transform: translateY(0);
        }

        .player-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .player-thumbnail {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            animation: rotate 20s linear infinite paused;
            cursor: pointer;
        }

        .player-container.playing .player-thumbnail {
            animation-play-state: running;
        }

        .player-info {
            flex: 1;
            cursor: pointer;
        }

        .player-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: var(--text-primary);
        }

        .player-channel {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .control-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: var(--text-primary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: var(--bg-secondary);
            transform: scale(1.1);
            border-color: var(--accent-1);
        }

        .play-pause-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, var(--accent-1), var(--accent-2));
            border: none;
            font-size: 1.2rem;
        }

        .play-pause-btn:hover {
            box-shadow: 0 0 30px var(--accent-1);
        }

        .queue-toggle-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .queue-toggle-btn:hover {
            border-color: var(--accent-1);
        }

        /* Progress bar */
        .progress-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--bg-secondary);
            cursor: pointer;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
            width: 0%;
            transition: width 0.1s linear;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--text-primary);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent-1);
        }

        /* Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Loading spinner */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-1);
            border-radius: 50%;
            margin: 0 auto;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Hidden iframe */
        #player-iframe {
            position: absolute;
            top: -1000px;
            left: -1000px;
            width: 1px;
            height: 1px;
        }

        /* Mobile responsive for card player */
        @media (max-width: 768px) {
            .card-player {
                width: 95vw;
                height: 95vh;
            }
            
            .card-player-content {
                flex-direction: column;
            }
            
            .card-player-left {
                padding: 1rem;
            }
            
            .card-player-thumbnail {
                width: 200px;
                height: 200px;
            }
            
            .card-player-right {
                border-left: none;
                border-top: 1px solid var(--border-color);
                flex: 1;
            }
            
            .queue-panel {
                width: 100vw;
                right: -100vw;
            }
            
            .player-content {
                padding: 1rem;
                gap: 1rem;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="theme-btn active" onclick="setTheme('light')">🌞</button>
        <button class="theme-btn" onclick="setTheme('dark')">🌙</button>
        <button class="theme-btn" onclick="setTheme('neon')">⚡</button>
    </div>

    <div class="background"></div>
    <div class="particles" id="particles"></div>

    <div class="container">
        <header class="header">
            <h1 class="logo">Blue Music</h1>
            <p style="color: var(--text-secondary);">Experience music like never before</p>
        </header>

        <div class="search-container">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="Search for your favorite music...">
                <button class="search-btn" onclick="searchMusic()">Search</button>
            </div>
        </div>

        <div id="results" class="results-container"></div>
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Card Mode Player -->
    <div class="card-player" id="cardPlayer">
        <div class="card-player-header">
            <div class="card-player-title">Now Playing</div>
            <button class="card-player-close" onclick="minimizePlayer()">✕</button>
        </div>
        <div class="card-player-content">
            <div class="card-player-left">
                <img class="card-player-thumbnail" id="cardPlayerThumbnail" src="" alt="">
                <div class="card-player-info">
                    <div class="card-player-song-title" id="cardPlayerTitle"></div>
                    <div class="card-player-artist" id="cardPlayerArtist"></div>
                </div>
                <div class="card-player-controls">
                    <button class="card-control-btn" onclick="previousTrack()">⏮</button>
                    <button class="card-control-btn" onclick="seekBackward()">⏪</button>
                    <button class="card-control-btn card-play-pause-btn" id="cardPlayPauseBtn" onclick="togglePlayPause()">▶️</button>
                    <button class="card-control-btn" onclick="seekForward()">⏩</button>
                    <button class="card-control-btn" onclick="nextTrack()">⏭</button>
                </div>
            </div>
            <div class="card-player-right">
                <div class="lyrics-header">🎵 Lyrics</div>
                <div class="lyrics-content" id="lyricsContent">
                    <div class="lyrics-loading">Loading lyrics...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Queue Panel -->
    <div class="queue-panel" id="queuePanel">
        <div class="queue-header">
            <div class="queue-title">Queue</div>
            <button class="queue-close" onclick="toggleQueue()">✕</button>
        </div>
        <div class="queue-list" id="queueList">
            <!-- Queue items will be dynamically added here -->
        </div>
    </div>

    <!-- Minimized Player -->
    <div class="player-container" id="playerContainer">
        <div class="progress-container" onclick="seekTo(event)">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="player-content">
            <img class="player-thumbnail" id="playerThumbnail" src="" alt="" onclick="expandPlayer()">
            <div class="player-info" onclick="expandPlayer()">
                <div class="player-title" id="playerTitle"></div>
                <div class="player-channel" id="playerChannel"></div>
            </div>
            <div class="player-controls">
                <button class="control-btn" onclick="previousTrack()">⏮</button>
                <button class="control-btn" onclick="seekBackward()">⏪</button>
                <button class="control-btn play-pause-btn" id="playPauseBtn" onclick="togglePlayPause()">▶️</button>
                <button class="control-btn" onclick="seekForward()">⏩</button>
                <button class="control-btn" onclick="nextTrack()">⏭</button>
                <button class="queue-toggle-btn" onclick="toggleQueue()">Queue (0)</button>
            </div>
        </div>
    </div>

    <div id="player-iframe"></div>

    <script>
        // Global variables
        let player;
        let currentVideoId = null;
        let isPlaying = false;
        let updateInterval;
        let isCardMode = false;
        let musicQueue = [];
        let currentQueueIndex = -1;

        // Theme management
        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            localStorage.setItem('theme', theme);
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
        document.querySelector(`[onclick="setTheme('${savedTheme}')"]`).classList.add('active');

        // Enhanced particle creation
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            particlesContainer.innerHTML = '';
            
            for (let i = 0; i < 80; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 15) + 's';
                
                const size = 2 + Math.random() * 4;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // Add variety to particle colors
                const colors = [
                    'rgba(138, 43, 226, 0.8)',
                    'rgba(30, 144, 255, 0.8)',
                    'rgba(255, 255, 255, 0.6)',
                    'rgba(255, 233, 30, 0.7)'
                ];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.boxShadow = `0 0 10px ${colors[Math.floor(Math.random() * colors.length)]}`;
                
                particlesContainer.appendChild(particle);
            }
        }

        // Mobile detection and optimization
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        function optimizeForMobile() {
            if (isMobile()) {
                document.body.classList.add('mobile');
                // Create fewer particles for mobile performance
                document.getElementById('particles').innerHTML = '';
                for (let i = 0; i < 30; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 20 + 's';
                    particle.style.animationDuration = (20 + Math.random() * 10) + 's';
                    
                    const size = 2 + Math.random() * 3;
                    particle.style.width = size + 'px';
                    particle.style.height = size + 'px';
                    
                    document.getElementById('particles').appendChild(particle);
                }
            }
        }

        // Load YouTube IFrame API
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            console.log('YouTube API Ready');
        }

        // Enhanced search with embeddable filtering
        async function searchMusic() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            const resultsContainer = document.getElementById('results');
            const loading = document.getElementById('loading');
            
            resultsContainer.innerHTML = '';
            loading.style.display = 'block';

            try {
                const API_KEY = 'AIzaSyCf_EP7zzvFWfZFIDhgez2CHOpzJ_s53AY';
                
                const searchResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&videoCategoryId=10&maxResults=20&key=${API_KEY}`);
                
                if (!searchResponse.ok) {
                    throw new Error(`Search API Error: ${searchResponse.status}`);
                }
                
                const searchData = await searchResponse.json();

                if (!searchData.items || searchData.items.length === 0) {
                    loading.style.display = 'none';
                    resultsContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No results found. Try a different search term.</p>';
                    return;
                }

                const videoIds = searchData.items.map(item => item.id.videoId).join(',');
                const detailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,status&id=${videoIds}&key=${API_KEY}`);
                
                if (!detailsResponse.ok) {
                    throw new Error(`Details API Error: ${detailsResponse.status}`);
                }
                
                const detailsData = await detailsResponse.json();
                loading.style.display = 'none';

                const embeddableVideos = detailsData.items.filter(video => {
                    return video.status.embeddable === true && 
                           video.status.privacyStatus === 'public' &&
                           (!video.status.uploadStatus || video.status.uploadStatus === 'processed');
                });

                if (embeddableVideos.length === 0) {
                    resultsContainer.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary);">
                            <p>⚠️ No embeddable videos found for "${query}"</p>
                            <p>Try searching for different terms</p>
                        </div>
                    `;
                    return;
                }

                embeddableVideos.forEach((video, index) => {
                    const item = {
                        id: { videoId: video.id },
                        snippet: video.snippet
                    };
                    
                    const card = createResultCard(item);
                    card.style.animationDelay = `${index * 0.1}s`;
                    resultsContainer.appendChild(card);
                });

            } catch (error) {
                console.error('Search error:', error);
                loading.style.display = 'none';
                
                resultsContainer.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary);">
                        <p>⚠️ Search temporarily unavailable</p>
                        <p>Error: ${error.message}</p>
                        <p>Using demo songs below instead</p>
                    </div>
                `;
                
                showDemoResults();
            }
        }

        // Enhanced createResultCard with queue button
        function createResultCard(item) {
            const card = document.createElement('div');
            card.className = 'result-card';
            
            card.innerHTML = `
                <div style="position: relative;">
                    <img class="result-thumbnail" src="${item.snippet.thumbnails.high.url}" alt="${item.snippet.title}">
                    <button class="queue-btn" onclick="addToQueue('${item.id.videoId}', '${item.snippet.title.replace(/'/g, "\\'")}', '${item.snippet.channelTitle.replace(/'/g, "\\'")}', '${item.snippet.thumbnails.high.url}'); event.stopPropagation();">
                        ➕ Queue
                    </button>
                    <div style="position: absolute; top: 8px; right: 8px; background: rgba(0, 255, 0, 0.8); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold;">
                        ✓ PLAYABLE
                    </div>
                </div>
                <div class="result-info">
                    <div class="result-title">${item.snippet.title}</div>
                    <div class="result-channel">${item.snippet.channelTitle}</div>
                </div>
            `;
            
            // Add play functionality
            card.addEventListener('click', (e) => {
                if (!e.target.classList.contains('queue-btn')) {
                    playVideo(item.id.videoId, item.snippet.title, item.snippet.channelTitle, item.snippet.thumbnails.high.url);
                }
            });
            
            return card;
        }

        // Play video function
        function playVideo(videoId, title, channel, thumbnail) {
            currentVideoId = videoId;
            isCardMode = true;
            
            // Update both players
            updatePlayerInfo(title, channel, thumbnail);
            
            // Show card player
            document.getElementById('cardPlayer').classList.add('active');
            document.getElementById('playerContainer').classList.add('active');
            
            // Load lyrics
            loadLyrics(title, channel);
            
            setupMediaSession(title, channel, thumbnail);
            
            if (player) {
                player.loadVideoById(videoId);
            } else {
                player = new YT.Player('player-iframe', {
                    height: '1',
                    width: '1',
                    videoId: videoId,
                    playerVars: {
                        'autoplay': 1,
                        'controls': 0,
                        'modestbranding': 1,
                        'playsinline': 1,
                        'enablejsapi': 1,
                        'origin': window.location.origin
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange,
                        'onError': onPlayerError
                    }
                });
            }
        }

        // Update player info
        function updatePlayerInfo(title, channel, thumbnail) {
            // Update card player
            document.getElementById('cardPlayerTitle').textContent = title;
            document.getElementById('cardPlayerArtist').textContent = channel;
            document.getElementById('cardPlayerThumbnail').src = thumbnail;
            
            // Update minimized player
            document.getElementById('playerTitle').textContent = title;
            document.getElementById('playerChannel').textContent = channel;
            document.getElementById('playerThumbnail').src = thumbnail;
        }

        // Load lyrics function
        async function loadLyrics(title, artist) {
            const lyricsContent = document.getElementById('lyricsContent');
            lyricsContent.innerHTML = '<div class="lyrics-loading">Loading lyrics...</div>';
            
            try {
                // Using lyrics.ovh API as an example
                const response = await fetch(`https://api.lyrics.ovh/v1/${encodeURIComponent(artist)}/${encodeURIComponent(title)}`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.lyrics) {
                        lyricsContent.textContent = data.lyrics;
                    } else {
                        throw new Error('No lyrics found');
                    }
                } else {
                    throw new Error('Lyrics API error');
                }
            } catch (error) {
                console.log('Lyrics error:', error);
                lyricsContent.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary);">
                        <p>🎵 Lyrics not available</p>
                        <p style="margin-top: 1rem; font-size: 0.9rem;">
                            Enjoy the music and let your imagination<br>
                            paint the story behind the melody.
                        </p>
                        <div style="margin-top: 2rem; font-style: italic; line-height: 1.6;">
                            "Music is the universal language of mankind."<br>
                            - Henry Wadsworth Longfellow
                        </div>
                    </div>
                `;
            }
        }

        // Queue management
        function addToQueue(videoId, title, channel, thumbnail) {
            const queueItem = {
                videoId,
                title,
                channel,
                thumbnail
            };
            
            musicQueue.push(queueItem);
            updateQueueDisplay();
            
            // Show success message
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '✓ Added';
            btn.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
            }, 2000);
        }

        function updateQueueDisplay() {
            const queueList = document.getElementById('queueList');
            const queueToggleBtn = document.querySelector('.queue-toggle-btn');
            
            queueToggleBtn.textContent = `Queue (${musicQueue.length})`;
            
            queueList.innerHTML = '';
            
            musicQueue.forEach((item, index) => {
                const queueItem = document.createElement('div');
                queueItem.className = `queue-item ${index === currentQueueIndex ? 'current' : ''}`;
                
                queueItem.innerHTML = `
                    <img class="queue-thumbnail" src="${item.thumbnail}" alt="${item.title}">
                    <div class="queue-info">
                        <div class="queue-song-title">${item.title}</div>
                        <div class="queue-artist">${item.channel}</div>
                    </div>
                    <button class="queue-remove" onclick="removeFromQueue(${index})" title="Remove from queue">🗑️</button>
                `;
                
                queueItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('queue-remove')) {
                        playFromQueue(index);
                    }
                });
                
                queueList.appendChild(queueItem);
            });
        }

        function removeFromQueue(index) {
            musicQueue.splice(index, 1);
            if (currentQueueIndex > index) {
                currentQueueIndex--;
            } else if (currentQueueIndex === index) {
                currentQueueIndex = -1;
            }
            updateQueueDisplay();
        }

        function playFromQueue(index) {
            currentQueueIndex = index;
            const item = musicQueue[index];
            playVideo(item.videoId, item.title, item.channel, item.thumbnail);
            updateQueueDisplay();
        }

        function nextTrack() {
            if (musicQueue.length === 0) return;
            
            const nextIndex = (currentQueueIndex + 1) % musicQueue.length;
            playFromQueue(nextIndex);
        }

        function previousTrack() {
            if (musicQueue.length === 0) return;
            
            const prevIndex = currentQueueIndex <= 0 ? musicQueue.length - 1 : currentQueueIndex - 1;
            playFromQueue(prevIndex);
        }

        // Player controls
        function toggleQueue() {
            const queuePanel = document.getElementById('queuePanel');
            queuePanel.classList.toggle('active');
        }

        function expandPlayer() {
            document.getElementById('cardPlayer').classList.add('active');
            isCardMode = true;
        }

        function minimizePlayer() {
            document.getElementById('cardPlayer').classList.remove('active');
            isCardMode = false;
        }

        function onPlayerReady(event) {
            event.target.playVideo();
            startProgressUpdate();
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                isPlaying = true;
                document.getElementById('playPauseBtn').textContent = '⏸️';
                document.getElementById('cardPlayPauseBtn').textContent = '⏸️';
                document.getElementById('playerContainer').classList.add('playing');
                document.getElementById('cardPlayer').classList.add('playing');
                
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = 'playing';
                }
                
            } else if (event.data == YT.PlayerState.PAUSED) {
                isPlaying = false;
                document.getElementById('playPauseBtn').textContent = '▶️';
                document.getElementById('cardPlayPauseBtn').textContent = '▶️';
                document.getElementById('playerContainer').classList.remove('playing');
                document.getElementById('cardPlayer').classList.remove('playing');
                
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = 'paused';
                }
            } else if (event.data == YT.PlayerState.ENDED) {
                // Auto-play next track in queue
                nextTrack();
            }
        }

        function onPlayerError(event) {
            console.error('Player error occurred:', event.data);
            
            const errorMessages = {
                2: 'Invalid video ID - Video may have been removed',
                5: 'HTML5 player error - Try refreshing the page',
                100: 'Video not found or has been made private',
                101: 'Video not available in your country/region', 
                150: 'Video owner has disabled embedding for this video'
            };
            
            const message = errorMessages[event.data] || 'Unknown player error occurred';
            
            const playerTitle = document.getElementById('playerTitle');
            const cardPlayerTitle = document.getElementById('cardPlayerTitle');
            const originalTitle = playerTitle.textContent;
            
            playerTitle.textContent = `❌ ${message}`;
            cardPlayerTitle.textContent = `❌ ${message}`;
            playerTitle.style.color = '#ff6b6b';
            cardPlayerTitle.style.color = '#ff6b6b';
            
            setTimeout(() => {
                playerTitle.textContent = originalTitle;
                cardPlayerTitle.textContent = originalTitle;
                playerTitle.style.color = '';
                cardPlayerTitle.style.color = '';
            }, 4000);
        }

        function togglePlayPause() {
            if (!player) return;
            
            if (isPlaying) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        function seekForward() {
            if (!player) return;
            const currentTime = player.getCurrentTime();
            player.seekTo(currentTime + 10, true);
        }

        function seekBackward() {
            if (!player) return;
            const currentTime = player.getCurrentTime();
            player.seekTo(Math.max(0, currentTime - 10), true);
        }

        function seekTo(event) {
            if (!player) return;
            const progressContainer = event.currentTarget;
            const clickX = event.offsetX;
            const width = progressContainer.offsetWidth;
            const percentage = clickX / width;
            const duration = player.getDuration();
            player.seekTo(duration * percentage, true);
        }

        function startProgressUpdate() {
            if (updateInterval) clearInterval(updateInterval);
            
            updateInterval = setInterval(() => {
                if (player && player.getCurrentTime) {
                    const currentTime = player.getCurrentTime();
                    const duration = player.getDuration();
                    const percentage = (currentTime / duration) * 100;
                    document.getElementById('progressBar').style.width = percentage + '%';
                }
            }, 100);
        }

        // Media Session API
        function setupMediaSession(title, artist, artwork) {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: title,
                    artist: artist,
                    album: 'Blue Music Player',
                    artwork: [
                        { src: artwork, sizes: '96x96', type: 'image/jpeg' },
                        { src: artwork, sizes: '128x128', type: 'image/jpeg' },
                        { src: artwork, sizes: '192x192', type: 'image/jpeg' },
                        { src: artwork, sizes: '256x256', type: 'image/jpeg' },
                        { src: artwork, sizes: '384x384', type: 'image/jpeg' },
                        { src: artwork, sizes: '512x512', type: 'image/jpeg' }
                    ]
                });

                navigator.mediaSession.setActionHandler('play', () => {
                    if (player) player.playVideo();
                });

                navigator.mediaSession.setActionHandler('pause', () => {
                    if (player) player.pauseVideo();
                });

                navigator.mediaSession.setActionHandler('previoustrack', () => {
                    previousTrack();
                });

                navigator.mediaSession.setActionHandler('nexttrack', () => {
                    nextTrack();
                });

                navigator.mediaSession.setActionHandler('seekbackward', (details) => {
                    if (player) {
                        const currentTime = player.getCurrentTime();
                        player.seekTo(Math.max(0, currentTime - (details.seekOffset || 10)), true);
                    }
                });

                navigator.mediaSession.setActionHandler('seekforward', (details) => {
                    if (player) {
                        const currentTime = player.getCurrentTime();
                        const duration = player.getDuration();
                        player.seekTo(Math.min(duration, currentTime + (details.seekOffset || 10)), true);
                    }
                });
            }
        }

        // Demo results
        function showDemoResults() {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';
            
            const demoResults = [
                {
                    id: { videoId: 'e2smuEY2BOI' },
                    snippet: {
                        title: 'Meghomilon - Tanjib Sarowar',
                        channelTitle: 'G-Series Music',
                        thumbnails: { high: { url: 'https://i.ytimg.com/vi/e2smuEY2BOI/hqdefault.jpg' } }
                    }
                },
                {
                    id: { videoId: '60ItHLz5WEA' },
                    snippet: {
                        title: 'Faded - Alan Walker',
                        channelTitle: 'Alan Walker',
                        thumbnails: { high: { url: 'https://i.ytimg.com/vi/60ItHLz5WEA/hqdefault.jpg' } }
                    }
                },
                {
                    id: { videoId: 'C-0vOChcjHo' },
                    snippet: {
                        title: 'Alo Alo - Tahsan',
                        channelTitle: 'G-Series Music', 
                        thumbnails: { high: { url: 'https://i.ytimg.com/vi/C-0vOChcjHo/hqdefault.jpg' } }
                    }
                }
            ];
            
            demoResults.forEach((item, index) => {
                const card = createResultCard(item);
                card.style.animationDelay = `${index * 0.1}s`;
                resultsContainer.appendChild(card);
            });
        }

        // Page visibility handling
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (player && isPlaying) {
                    setTimeout(() => {
                        if (player.getPlayerState() === YT.PlayerState.PAUSED) {
                            player.playVideo();
                        }
                    }, 100);
                }
            }
        });

        // Enter key support
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchMusic();
            }
        });

        // Initialize
        window.addEventListener('load', () => {
            optimizeForMobile();
            createParticles();
            showDemoResults();
        });

        // Regenerate particles periodically
        setInterval(createParticles, 60000); // Every minute
    </script>
</body>
</html>
